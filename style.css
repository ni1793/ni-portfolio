:root {
    --bg-color: #f4f4f4;
    --card-bg: #ffffff;
    --border-color: #111;
}

body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: var(--bg-color);
    /* 預設隱藏卷軸 (電腦版維持不變) */
    overflow: hidden; 
    user-select: none;
}

/* =========================================
   1. 3D 場景
   ========================================= */
.scene {
    position: relative;
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
    perspective: 2500px;
    overflow: visible; 
    cursor: grab;
}
.scene:active { cursor: grabbing; }

.spine-wrapper {
    position: relative;
    width: 0; height: 0;
    transform-style: preserve-3d;
    transform: rotateX(25deg) translateY(50px);
    transition: transform 0.5s ease;
}

@keyframes breathing {
    0%, 100% { transform: rotateX(25deg) translateY(50px); }
    50% { transform: rotateX(27deg) translateY(40px); }
}
.scene:hover .spine-wrapper {
    animation: breathing 4s ease-in-out infinite;
}

.book-spine {
    position: absolute; width: 0; height: 0;
    top: 0; left: 0;
    transform-style: preserve-3d;
}

/* =========================================
   2. 卡片容器
   ========================================= */
.book-page {
    position: absolute;
    width: 300px; height: 450px;
    left: 50%; top: 50%;
    margin-left: 0; 
    /* 電腦版保持這個設定，手機版我們會覆蓋它 */
    margin-top: 120px;
    transform-origin: left center;
    transform-style: preserve-3d;
    cursor: pointer;
    transition: transform 1.2s ease-out;
}

/* =========================================
   3. 正反面結構
   ========================================= */
.page-front, .page-back {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    border: 1px solid var(--border-color);
    background-color: #fff;
    display: flex; flex-direction: column;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.page-front { z-index: 2; }
.page-back { transform: rotateY(180deg); background-color: #fff; z-index: 1; }

.book-page.closed { transform: rotateY(0deg) translateZ(0) !important; }
.book-page.closed .page-front { box-shadow: 1px 0 0 #ccc; border-right: 1px solid #ddd; }

.book-page:hover .page-front { box-shadow: 0 30px 60px rgba(0,0,0,0.2); border-color: #000; }
.book-page:hover { z-index: 2000 !important; }

.book-page.is-cover .page-front { background: #111; color: #fff; border: 1px solid #000; }
.book-page.is-cover .page-title { color: #fff; position: absolute; bottom: 20px; left: 20px; font-size: 24px; letter-spacing: 2px; }
.book-page.is-cover .page-index { color: #666; }

.page-top {
    position: absolute; top: -1px; left: 0; width: 100%; height: 2px;
    background: #000; display: block;
    backface-visibility: hidden;
}

/* =========================================
   4. 內容排版
   ========================================= */
.page-header {
    height: 30px; border-bottom: 1px solid #111;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 15px; background: transparent; flex-shrink: 0;
}
.page-index { font-size: 12px; font-weight: 900; color: #000; }
.page-year { font-size: 10px; font-family: monospace; color: #666; }

.page-content {
    flex: 1; padding: 15px; display: flex; flex-direction: column; overflow: hidden; min-height: 0;
}
.page-image {
    width: 100%; height: 100%; flex: 1; margin-bottom: 10px;
    background-size: cover; background-position: center; background-repeat: no-repeat;
    border: 1px solid #eee;
    filter: grayscale(100%); transition: filter 0.5s ease;
    display: block;
}
.book-spine.is-open .book-page:hover .page-image { filter: grayscale(0%); }
.book-page.is-cover .page-image { filter: grayscale(0%); border: none; }

.page-footer { 
    padding: 15px; border-top: 1px solid #111; flex-shrink: 0; 
    display: flex; justify-content: flex-end; 
}
.page-title { 
    font-size: 10px; font-weight: 400; text-transform: uppercase; 
    margin: 0; line-height: 1.4; letter-spacing: 1px; text-align: right; color: #333;
}

/* =========================================
   5. UI 元素
   ========================================= */
.grid-background {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-size: 60px 60px; pointer-events: none;
}

.site-intro { position: fixed; top: 40px; left: 40px; z-index: 100; pointer-events: none; }
.site-intro h1 { font-size: 32px; font-weight: 900; margin: 0; line-height: 1; color: #000; }
.site-intro h2 { font-size: 12px; font-weight: 600; margin: 6px 0 0 0; letter-spacing: 2px; color: #666; }

.text-nav {
    position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 50px; z-index: 100;
}
.text-nav span {
    cursor: pointer; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 2px;
    border-bottom: 2px solid transparent; transition: border 0.3s; color: #000;
}
.text-nav span:hover { border-bottom: 2px solid #000; }

#login-page {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: #000; background-image: none;
    z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: white; transition: opacity 0.6s ease; overflow: hidden;
}
#login-page.hidden { opacity: 0; display: none !important; pointer-events: none; } 

#particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
.login-content { position: relative; z-index: 2; text-align: center; pointer-events: auto; }

/* [修改] 時間區塊：增加 Flex 置中設定 */
.date-time {
    display: flex;
    flex-direction: column;
    align-items: center; /* 水平置中關鍵 */
    justify-content: center;
    width: 100%; /* 確保佔滿寬度 */
    text-align: center; /* 雙重保險 */
}

.date-time h1 { font-size: 80px; font-weight: 100; margin: 0; letter-spacing: 5px; }
.date-time p { font-size: 14px; letter-spacing: 3px; color: #aaa; margin-top: 10px; }

.password-wrapper {
    margin-top: 40px; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);
    padding: 12px 50px; font-weight: 400; letter-spacing: 4px; font-size: 12px;
    transition: all 0.3s; background: rgba(0,0,0,0.5); color: #fff; display: inline-block;
}
.password-wrapper:hover { background: #fff; color: #000; box-shadow: 0 0 20px rgba(255,255,255,0.5); }

/* [修改] 彈跳視窗：大幅提高 z-index 確保蓋過閱讀模式的書本 */
.modal-overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(255,255,255,0.95); 
    
z-index: 20000 !important;
    
    display: flex; justify-content: center; align-items: center; 
    opacity: 0; transition: opacity 0.3s;
}
.modal-overlay.hidden { display: none !important; pointer-events: none; }
.modal-overlay:not(.hidden) { opacity: 1; display: flex !important; pointer-events: auto; }

.finder-window { width: 80%; max-width: 800px; height: 80vh; background: #fff; border: 2px solid #000; display: flex; flex-direction: column; box-shadow: 20px 20px 0 rgba(0,0,0,0.1); }
.contact-window { max-width: 500px; height: auto; max-height: 80vh; }
.finder-header { height: 60px; border-bottom: 2px solid #000; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
.close-icon { font-size: 28px; cursor: pointer; }
.finder-content { padding: 50px; overflow-y: auto; }
.detail-images img { width: 100%; margin-bottom: 20px; border: 1px solid #000; }

.contact-content { display: flex; justify-content: center; padding: 0; }
.contact-card { width: 100%; border: none; }
.contact-row { display: flex; border-bottom: 1px solid #eee; padding: 20px; align-items: baseline; }
.contact-row:last-child { border-bottom: none; }
.label { width: 100px; font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; }
.value { font-size: 16px; font-weight: 500; color: #000; }
.value a { text-decoration: none; color: #000; border-bottom: 1px solid transparent; }
.value a:hover { border-bottom: 1px solid #000; }

/* [修改] 燈箱 (點擊圖片放大)：確保是全站最高層級 */
.lightbox-overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: #fff; 
    
z-index: 30000 !important;
    
    display: flex; justify-content: center; align-items: center; 
    opacity: 0; 
}
.lightbox-overlay.hidden { display: none !important; }
.lightbox-overlay:not(.hidden) { opacity: 1; display: flex !important; }
.lightbox-overlay img { max-width: 90%; max-height: 90%; border: 5px solid #fff; box-shadow: 0 0 40px rgba(0,0,0,0.1); }
.close-btn { position: absolute; top: 30px; right: 30px; font-size: 40px; cursor: pointer; }

/* 游標設定 */
@media (min-width: 769px) {
    body, a, div, span { cursor: none !important; }
}
#main-cursor {
    position: fixed; top: 0; left: 0; width: 15px; height: 15px;
    background-color: rgba(255, 50, 50, 0.6); border: none; border-radius: 50%;
    pointer-events: none; z-index: 9999999 !important; will-change: transform; display: block;
}
#cursor-bubble {
    position: fixed; top: 0; left: 0; background-color: #000; color: #fff;
    padding: 8px 16px; border-radius: 50px; font-size: 14px; font-weight: 900; font-style: italic;
    white-space: nowrap; pointer-events: none; z-index: 10001; opacity: 0; transform: scale(0.5);
    transition: opacity 0.2s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
#cursor-bubble.active { opacity: 1; }
#cursor-bubble::after {
    content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
    border-width: 6px 6px 0; border-style: solid; border-color: #000 transparent transparent transparent; 
}

/* 漫畫風特效 */
.comic-line {
    position: absolute; height: 2px; background: #000; transform-origin: left center; z-index: 9999; animation: shot-line 0.4s ease-out forwards;
}
@keyframes shot-line {
    0% { transform: scaleX(0); opacity: 1; }
    50% { opacity: 1; }
    100% { transform: scaleX(1); opacity: 0; }
}

/* 預設隱藏手機版新功能元素 */
#mobile-scroll-indicator,
#mobile-photo-preview {
    display: none;
}

/* =========================================
   6. 手機版優化 (Mobile Optimization) - 已更新
   ========================================= */
@media (max-width: 768px) {
    /* [重要] 允許手機版垂直滾動，這樣才能看到下方的相簿 */
    body, html {
        overflow-y: auto !important;
        overflow-x: hidden;
        height: auto; /* 讓內容決定高度 */
    }

    /* 確保 3D 場景區塊佔滿一個螢幕高度 */
    #home-page {
        position: relative;
        width: 100%;
        height: 100vh; /* 第一屏 */
        overflow: hidden; /* 確保裡面的 3D 不會跑版 */
    }

    .scene:hover .spine-wrapper { animation: none !important; }
    
    .spine-wrapper {
        transform: rotateX(25deg) translateY(0px) scale(0.6) translateX(-90px) !important;
        transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1) !important;
    }

    /* 針對手機版：書本頁面強制置中 */
    /* 原本的 margin-top: 120px 會把書往下推，這裡改為 -225px (書高 450px 的一半) 
       這樣 top: 50% 加上 margin-top 負一半高度，就會是完美的垂直居中 */
    .book-page {
        margin-top: -225px !important;
    }

    body.is-book-open .spine-wrapper {
        transform: rotateX(25deg) translateY(0px) scale(0.6) translateX(0px) !important;
    }

    @media (max-width: 380px) {
        /* 小螢幕微調 */
        .spine-wrapper { transform: rotateX(25deg) translateY(-20px) scale(0.5) translateX(-100px) !important; }
        .book-page { margin-top: -225px !important; } /* 保持垂直置中 */
        body.is-book-open .spine-wrapper { transform: rotateX(25deg) translateY(-20px) scale(0.5) translateX(0px) !important; }
    }

    /* [修改] 氣泡位置設定：從中間往上提 */
    /* calc(50% - 180px)：50%是中心，180px 大約是書本縮放後的一半高度+間距 */
    #cursor-bubble { 
        transition: opacity 0.3s !important; 
        top: calc(50% - 180px) !important; 
        left: 50% !important; 
        margin: 0 !important; 
        animation: float-mobile 2s ease-in-out infinite; 
    }
    
    #cursor-bubble.active-mobile { opacity: 1 !important; transform: translate(-50%, -50%) scale(1) !important; }
    body.is-book-open #cursor-bubble { display: none !important; opacity: 0 !important; animation: none; }
    #main-cursor { display: none !important; }

    @keyframes float-mobile {
        0%, 100% { transform: translate(-50%, -50%); }
        50% { transform: translate(-50%, -60%); } /* 浮動時稍微往上一點 */
    }

    .text-nav span:first-child {
        display: none; 
    }
/* [新增] 當滾動時強制隱藏氣泡的 Class */
#cursor-bubble.hide-on-scroll {
    opacity: 0 !important;
    transform: translate(-50%, -50%) scale(0) !important;
    transition: all 0.3s ease;
    pointer-events: none;
}
    /* --- 下滑提示箭頭 --- */
    #mobile-scroll-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: absolute;
        bottom: 30px; /* 在導覽列下方 */
        left: 50%;
        transform: translateX(-50%);
        z-index: 50;
        animation: bounceArrow 2s infinite;
        pointer-events: none;
    }
    #mobile-scroll-indicator i {
        font-size: 24px;
        color: #000;
        margin-top: 5px;
    }
    #mobile-scroll-indicator span {
        font-size: 10px;
        letter-spacing: 2px;
        color: #666;
    }
    @keyframes bounceArrow {
        0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
        40% { transform: translateX(-50%) translateY(-10px); }
        60% { transform: translateX(-50%) translateY(-5px); }
    }

 /* --- 新增：攝影作品預覽區塊 (在書本下方) --- */
    #mobile-photo-preview {
        display: block; 
        position: relative;
        width: 100%;
        min-height: 100vh;
        background-color: #f4f4f4;
        /* [修改] 增加底部空間，讓滑到底時不會覺得很擠 */
        padding: 60px 20px 150px 20px; 
        box-sizing: border-box;
        overflow: hidden;
        z-index: 20;
    }

/* [修改] 容器改為自然高度，允許內容撐開 */
    .preview-container {
        perspective: 1000px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start; /* 從頂部開始排列 */
        padding-top: 50px; /* 留一點頂部空間 */
        position: relative;
        height: auto; /* 高度自動 */
        overflow: visible; 
    }

    /* [修改] 照片改為相對定位，讓它們自然垂直排列 */
    .photo-wrapper {
        position: relative; /* 改回 relative */
        width: 60%; 
        max-width: 240px; 
        height: auto;
        
        background-color: #fff;
        padding: 12px 12px 50px 12px; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        
        /* [關鍵] 設定負的 margin-top，讓下一張照片會稍微蓋住上一張的底部，但整體是往下排的 */
        margin-top: -80px; 
        
        opacity: 0;
        transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 1s ease;
        will-change: transform, opacity;
        
        transform-origin: center 20px; 
    }

    /* 第一張照片不需要往上疊 */
    .photo-wrapper:first-child {
        margin-top: 0;
    }

    /* 內層照片 */
    .photo-wrapper img {
        width: 100%;
        height: auto;
        display: block;
        filter: sepia(10%);
    }

    /* 圖釘樣式保持不變 */
    .pin {
        position: absolute;
        top: -8px; 
        left: 50%;
        transform: translateX(-50%);
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #f0f0f0, #bdc3c7, #7f8c8d);
        box-shadow: 2px 3px 5px rgba(0,0,0,0.3), inset 1px 1px 1px rgba(255,255,255,0.8);
        z-index: 10;
    }

    /* 飛入方向設定 (保持左右交錯感) */
    .photo-wrapper:nth-child(even) {
        /* 初始位置在右下方 */
        transform: translate3d(100px, 100px, 0) rotate(20deg) scale(0.8);
    }
    .photo-wrapper:nth-child(odd) {
        /* 初始位置在左下方 */
        transform: translate3d(-100px, 100px, 0) rotate(-20deg) scale(0.8);
    }

    /* [修改] 飛入後的狀態：因為現在是 relative 定位，所以 translate 改為小幅度的隨機微調即可 */
    .photo-wrapper.visible {
        opacity: 1;
        /* var(--x), var(--y) 現在只負責微調位置，不會影響整體垂直排列 */
        transform: translate3d(var(--x), var(--y), 0) rotate(var(--r)) scale(1) !important;
    }

    /* 漂浮動畫 */
    .photo-wrapper.visible {
        animation: floatingPolaroid 5s ease-in-out infinite alternate;
        /* 隨機延遲，讓漂浮不同步 */
        animation-delay: calc(var(--delay) * 1s);
    }
    
/* [修改] 按鈕位置：大幅縮小上方的空白 */
    .view-more-btn {
        position: relative;
        margin-top: 10px; /* 從 80px 改為 20px，拉近距離 */
        
        padding: 8px 24px;
        border: 1px solid #000;
        background: transparent;
        color: #000;
        font-size: 11px;
        letter-spacing: 2px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        opacity: 0;
        transform: translateY(20px);
    }

    /* 內層照片 */
    .photo-wrapper img {
        width: 100%;
        height: auto;
        display: block;
        filter: sepia(10%); /* 加一點點復古濾鏡 */
    }

/* [修改] 圖釘樣式：改為銀色金屬質感 */
    .pin {
        position: absolute;
        top: -8px; 
        left: 50%;
        transform: translateX(-50%);
        width: 14px;
        height: 14px;
        border-radius: 50%;
        
        /* 銀色金屬漸層：從亮白到深灰 */
        background: radial-gradient(circle at 30% 30%, #f0f0f0, #bdc3c7, #7f8c8d);
        /* 加上內發光與陰影，增加立體感 */
        box-shadow: 2px 3px 5px rgba(0,0,0,0.3), inset 1px 1px 1px rgba(255,255,255,0.8);
        z-index: 10;
    }
    /* 圖釘的針頭陰影 (選用，增加真實感) */
    .pin::after {
        content: '';
        position: absolute;
        top: 50%; left: 50%;
        width: 4px; height: 4px;
        background: rgba(0,0,0,0.5);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        filter: blur(1px);
        opacity: 0.5;
    }

    /* 飛入方向設定 */
    .photo-wrapper:nth-child(even) {
        transform: translate3d(150%, 100px, -200px) rotate(40deg) scale(0.5);
    }
    .photo-wrapper:nth-child(odd) {
        transform: translate3d(-150%, 100px, -200px) rotate(-40deg) scale(0.5);
    }
    .photo-wrapper:nth-child(3) {
        transform: translate3d(0, 250px, -300px) rotate(10deg) scale(0.3);
    }

    /* [修改] 飛入後的狀態：隨性亂放 */
    .photo-wrapper.visible {
        opacity: 1;
        /* 使用 JS 產生的隨機變數 (--x, --y, --r) 讓位置錯落 */
        transform: translate3d(var(--x), var(--y), 0) rotate(var(--r)) scale(1) !important;
    }

    /* 漂浮動畫 */
    .photo-wrapper.visible {
        animation: floatingPolaroid 5s ease-in-out infinite alternate;
        animation-delay: 2s;
    }

    @keyframes floatingPolaroid {
        0% { transform: translate3d(var(--x), var(--y), 0) rotate(var(--r)); }
        100% { transform: translate3d(var(--x), calc(var(--y) - 10px), 0) rotate(var(--r)); }
    }

    /* [修改] 按鈕樣式：變小 */
    .view-more-btn {
        /* 因為照片改為 absolute，按鈕需要 margin-top 來推開距離，或者直接定位在底部 */
        position: relative;
        margin-top: 90px; /* 確保按鈕在照片堆下方 */
        
        padding: 8px 24px; /* 縮小內距 */
        border: 1px solid #000;
        background: transparent;
        color: #000;
        
        font-size: 11px; /* 縮小字體 */
        letter-spacing: 2px;
        font-weight: 600;
        
        cursor: pointer;
        transition: all 0.3s;
        opacity: 0;
        transform: translateY(20px);
    }
    .view-more-btn.visible {
        opacity: 1;
        transform: translateY(0);
        transition-delay: 2.5s;
    }
    .view-more-btn:active {
        background: #000;
        color: #fff;
    }/* ... 這是手機版區域原本的最後面 ... */

 /* =========================================
       [最終修正版] 手機版專注閱讀模式 (Reading Mode)
       ========================================= */
    
    body.reading-mode {
        overflow: hidden !important; /* 鎖定網頁 */
        touch-action: none; 
    }

    /* 隱藏其他干擾元素 */
    body.reading-mode .text-nav,
    body.reading-mode #mobile-scroll-indicator,
    body.reading-mode .site-intro,
    body.reading-mode #cursor-bubble {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
    }

    /* [修正 1] 提升 Scene 的層級，確保書本一定在遮罩上面 */
    body.reading-mode .scene {
        position: relative;
        z-index: 10000 !important; /* 關鍵：比遮罩高 */
    }

    /* [修正 2] 調整書本位置與大小 */
    body.reading-mode .spine-wrapper {
        /* translateX(-20px): 從原本的 -100 改回來，稍微偏左一點點即可，讓展開後的書本視覺置中
           scale(0.95): 稍微縮小一點點，避免大螢幕手機邊緣被切掉
        */
        transform: rotateX(10deg) translateY(0) scale(0.95) translateX(-20px) !important;
        
        /* 關閉動畫以確保拖曳跟手 */
        transition: none !important; 
    }

/* [修改] 遮罩改為灰色透明 */
    body.reading-mode::before {
        content: '';
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        
        /* 灰色 (100, 100, 100) + 透明度 0.9 */
        background: rgba(0, 0, 0, 0.6); 
        
        z-index: 9000; 
        animation: fadeIn 0.5s ease;
        pointer-events: none; 
        backdrop-filter: blur(2px); /* 稍微模糊背景 */
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    /* 閱讀模式下，增加書頁的陰影，讓立體感更強 */
    body.reading-mode .book-page {
         box-shadow: 0 10px 40px rgba(0,0,0,0.5) !important;
    }

/* ===============================================
   [最終層級修正] 強制讓彈跳視窗浮在最上層
   =============================================== */

/* 1. 彈跳視窗 (Project Modal & Contact Modal) */
/* 設定為 80000，確保比書籍(10000)和遮罩(9000)都高 */
.modal-overlay {
    z-index: 80000 !important;
}

/* 2. 燈箱圖片 (Lightbox) */
/* 設定為 90000，確保是全網站最高 */
.lightbox-overlay {
    z-index: 90000 !important;
}

/* 3. 確保書籍在閱讀模式時，雖然比遮罩高，但比彈跳視窗低 */
/* (這部分保持原本的 10000 即可，不需要動) */