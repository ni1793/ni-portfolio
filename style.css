:root {
    --bg-color: #f4f4f4;
    --card-bg: #ffffff;
    --border-color: #111;
}

body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: var(--bg-color);
    overflow: hidden; 
    user-select: none;
}

/* =========================================
   1. 3D 場景
   ========================================= */
.scene {
    position: relative;
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
    perspective: 2500px;
    overflow: visible; 
    cursor: grab;
}
.scene:active { cursor: grabbing; }

.spine-wrapper {
    position: relative;
    width: 0; height: 0;
    transform-style: preserve-3d;
    transform: rotateX(25deg) translateY(50px);
    transition: transform 0.5s ease;
}

@keyframes breathing {
    0%, 100% { transform: rotateX(25deg) translateY(50px); }
    50% { transform: rotateX(27deg) translateY(40px); }
}
.scene:hover .spine-wrapper {
    animation: breathing 4s ease-in-out infinite;
}

.book-spine {
    position: absolute; width: 0; height: 0;
    top: 0; left: 0;
    transform-style: preserve-3d;
}

/* =========================================
   2. 卡片容器
   ========================================= */
.book-page {
    position: absolute;
    width: 300px; height: 450px;
    left: 50%; top: 50%;
    margin-left: 0; 
    margin-top: 120px;
    transform-origin: left center;
    transform-style: preserve-3d;
    cursor: pointer;
    transition: transform 1.2s ease-out;
}

/* =========================================
   3. 正反面結構
   ========================================= */
.page-front, .page-back {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    border: 1px solid var(--border-color);
    background-color: #fff;
    display: flex; flex-direction: column;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.page-front { z-index: 2; }
.page-back { transform: rotateY(180deg); background-color: #fff; z-index: 1; }

.book-page.closed { transform: rotateY(0deg) translateZ(0) !important; }
.book-page.closed .page-front { box-shadow: 1px 0 0 #ccc; border-right: 1px solid #ddd; }

.book-page:hover .page-front { box-shadow: 0 30px 60px rgba(0,0,0,0.2); border-color: #000; }
.book-page:hover { z-index: 2000 !important; }

.book-page.is-cover .page-front { background: #111; color: #fff; border: 1px solid #000; }
.book-page.is-cover .page-title { color: #fff; position: absolute; bottom: 20px; left: 20px; font-size: 24px; letter-spacing: 2px; }
.book-page.is-cover .page-index { color: #666; }

.page-top {
    position: absolute; top: -1px; left: 0; width: 100%; height: 2px;
    background: #000; display: block;
    backface-visibility: hidden;
}

/* =========================================
   4. 內容排版
   ========================================= */
.page-header {
    height: 30px; border-bottom: 1px solid #111;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 15px; background: transparent; flex-shrink: 0;
}
.page-index { font-size: 12px; font-weight: 900; color: #000; }
.page-year { font-size: 10px; font-family: monospace; color: #666; }

.page-content {
    flex: 1; padding: 15px; display: flex; flex-direction: column; overflow: hidden; min-height: 0;
}
.page-image {
    width: 100%; height: 100%; flex: 1; margin-bottom: 10px;
    background-size: cover; background-position: center; background-repeat: no-repeat;
    border: 1px solid #eee;
    filter: grayscale(100%); transition: filter 0.5s ease;
    display: block;
}
.book-spine.is-open .book-page:hover .page-image { filter: grayscale(0%); }
.book-page.is-cover .page-image { filter: grayscale(0%); border: none; }

.page-footer { 
    padding: 15px; border-top: 1px solid #111; flex-shrink: 0; 
    display: flex; justify-content: flex-end; 
}
.page-title { 
    font-size: 10px; font-weight: 400; text-transform: uppercase; 
    margin: 0; line-height: 1.4; letter-spacing: 1px; text-align: right; color: #333;
}

/* =========================================
   5. UI 元素
   ========================================= */
.grid-background {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-size: 60px 60px; pointer-events: none;
}

.site-intro { position: fixed; top: 40px; left: 40px; z-index: 100; pointer-events: none; }
.site-intro h1 { font-size: 32px; font-weight: 900; margin: 0; line-height: 1; color: #000; }
.site-intro h2 { font-size: 12px; font-weight: 600; margin: 6px 0 0 0; letter-spacing: 2px; color: #666; }

.text-nav {
    position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 50px; z-index: 100;
}
.text-nav span {
    cursor: pointer; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 2px;
    border-bottom: 2px solid transparent; transition: border 0.3s; color: #000;
}
.text-nav span:hover { border-bottom: 2px solid #000; }

#login-page {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: #000; background-image: none;
    z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: white; transition: opacity 0.6s ease; overflow: hidden;
}
#login-page.hidden { opacity: 0; display: none !important; pointer-events: none; } 

#particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
.login-content { position: relative; z-index: 2; text-align: center; pointer-events: auto; }

.date-time {
    display: flex;
    flex-direction: column;
    align-items: center; 
    justify-content: center;
    width: 100%; 
    text-align: center; 
}

.date-time h1 { font-size: 80px; font-weight: 100; margin: 0; letter-spacing: 5px; }
.date-time p { font-size: 14px; letter-spacing: 3px; color: #aaa; margin-top: 10px; }

.password-wrapper {
    margin-top: 40px; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);
    padding: 12px 50px; font-weight: 400; letter-spacing: 4px; font-size: 12px;
    transition: all 0.3s; background: rgba(0,0,0,0.5); color: #fff; display: inline-block;
}
.password-wrapper:hover { background: #fff; color: #000; box-shadow: 0 0 20px rgba(255,255,255,0.5); }

/* 彈跳視窗 (Project Modal) */
.modal-overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(255,255,255,0.95); 
    display: flex; justify-content: center; align-items: center; 
    opacity: 0; transition: opacity 0.3s;
    /* [修改] 極高層級 */
    z-index: 80000 !important;
}
.modal-overlay.hidden { display: none !important; pointer-events: none; }
.modal-overlay:not(.hidden) { opacity: 1; display: flex !important; pointer-events: auto; }

.finder-window { width: 80%; max-width: 800px; height: 80vh; background: #fff; border: 2px solid #000; display: flex; flex-direction: column; box-shadow: 20px 20px 0 rgba(0,0,0,0.1); }
.contact-window { max-width: 500px; height: auto; max-height: 80vh; }
.finder-header { height: 60px; border-bottom: 2px solid #000; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
.close-icon { font-size: 28px; cursor: pointer; }
.finder-content { padding: 50px; overflow-y: auto; }
.detail-images img { width: 100%; margin-bottom: 20px; border: 1px solid #000; }

.contact-content { display: flex; justify-content: center; padding: 0; }
.contact-card { width: 100%; border: none; }
.contact-row { display: flex; border-bottom: 1px solid #eee; padding: 20px; align-items: baseline; }
.contact-row:last-child { border-bottom: none; }
.label { width: 100px; font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; }
.value { font-size: 16px; font-weight: 500; color: #000; }
.value a { text-decoration: none; color: #000; border-bottom: 1px solid transparent; }
.value a:hover { border-bottom: 1px solid #000; }

/* 燈箱 (Lightbox) */
.lightbox-overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: #fff; 
    display: flex; justify-content: center; align-items: center; 
    opacity: 0; 
    /* [修改] 全站最高層級 */
    z-index: 90000 !important;
}
.lightbox-overlay.hidden { display: none !important; }
.lightbox-overlay:not(.hidden) { opacity: 1; display: flex !important; }
.lightbox-overlay img { max-width: 90%; max-height: 90%; border: 5px solid #fff; box-shadow: 0 0 40px rgba(0,0,0,0.1); }
.close-btn { position: absolute; top: 30px; right: 30px; font-size: 40px; cursor: pointer; }

/* 游標設定 */
@media (min-width: 769px) {
    body, a, div, span { cursor: none !important; }
}
#main-cursor {
    position: fixed; top: 0; left: 0; width: 15px; height: 15px;
    background-color: rgba(255, 50, 50, 0.6); border: none; border-radius: 50%;
    pointer-events: none; z-index: 9999999 !important; will-change: transform; display: block;
}
#cursor-bubble {
    position: fixed; top: 0; left: 0; background-color: #000; color: #fff;
    padding: 8px 16px; border-radius: 50px; font-size: 14px; font-weight: 900; font-style: italic;
    white-space: nowrap; pointer-events: none; z-index: 10001; opacity: 0; transform: scale(0.5);
    transition: opacity 0.2s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
#cursor-bubble.active { opacity: 1; }
#cursor-bubble::after {
    content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
    border-width: 6px 6px 0; border-style: solid; border-color: #000 transparent transparent transparent; 
}

/* 漫畫風特效 (CSS保留，JS不觸發) */
.comic-line {
    position: absolute; height: 2px; background: #000; transform-origin: left center; z-index: 9999; animation: shot-line 0.4s ease-out forwards;
}
@keyframes shot-line {
    0% { transform: scaleX(0); opacity: 1; }
    50% { opacity: 1; }
    100% { transform: scaleX(1); opacity: 0; }
}

/* 預設隱藏手機版新功能元素 */
#mobile-scroll-indicator,
#mobile-photo-preview {
    display: none;
}
#cursor-bubble.hide-on-scroll {
    opacity: 0 !important;
    transform: translate(-50%, -50%) scale(0) !important;
    transition: all 0.3s ease;
    pointer-events: none;
}

/* =========================================
   手機版優化 (Mobile Optimization)
   ========================================= */
@media (max-width: 768px) {
    body, html {
        overflow-y: auto !important;
        overflow-x: hidden;
        height: auto; 
    }

    #home-page {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden; 
    }

    .scene:hover .spine-wrapper { animation: none !important; }
    
    .spine-wrapper {
        transform: rotateX(25deg) translateY(0px) scale(0.6) translateX(-90px) !important;
        transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1) !important;
    }

    .book-page {
        margin-top: -225px !important;
    }

    body.is-book-open .spine-wrapper {
        transform: rotateX(25deg) translateY(0px) scale(0.6) translateX(0px) !important;
    }

    @media (max-width: 380px) {
        .spine-wrapper { transform: rotateX(25deg) translateY(-20px) scale(0.5) translateX(-100px) !important; }
        .book-page { margin-top: -225px !important; } 
        body.is-book-open .spine-wrapper { transform: rotateX(25deg) translateY(-20px) scale(0.5) translateX(0px) !important; }
    }

    #cursor-bubble { 
        transition: opacity 0.3s !important; 
        top: calc(50% - 180px) !important; 
        left: 50% !important; 
        margin: 0 !important; 
        animation: float-mobile 2s ease-in-out infinite; 
    }
    
    #cursor-bubble.active-mobile { opacity: 1 !important; transform: translate(-50%, -50%) scale(1) !important; }
    body.is-book-open #cursor-bubble { display: none !important; opacity: 0 !important; animation: none; }
    #main-cursor { display: none !important; }

    @keyframes float-mobile {
        0%, 100% { transform: translate(-50%, -50%); }
        50% { transform: translate(-50%, -60%); } 
    }

    .text-nav span:first-child { display: none; }

    #mobile-scroll-indicator {
        display: flex; flex-direction: column; align-items: center;
        position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
        z-index: 50; animation: bounceArrow 2s infinite; pointer-events: none;
    }
    #mobile-scroll-indicator i { font-size: 24px; color: #000; margin-top: 5px; }
    #mobile-scroll-indicator span { font-size: 10px; letter-spacing: 2px; color: #666; }
    @keyframes bounceArrow {
        0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
        40% { transform: translateX(-50%) translateY(-10px); }
        60% { transform: translateX(-50%) translateY(-5px); }
    }

    #mobile-photo-preview {
        display: block; 
        position: relative;
        width: 100%;
        min-height: 100vh;
        background-color: #f4f4f4;
        padding: 60px 20px 150px 20px; 
        box-sizing: border-box;
        overflow: hidden;
        z-index: 20;
    }

    .preview-container {
        perspective: 1000px;
        display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
        padding-top: 50px; 
        position: relative; height: auto; overflow: visible; 
    }

    .photo-wrapper {
        position: relative; 
        width: 60%; max-width: 240px; height: auto;
        background-color: #fff;
        padding: 12px 12px 50px 12px; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        margin-top: -80px; 
        opacity: 0;
        transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 1s ease;
        will-change: transform, opacity;
        transform-origin: center 20px; 
    }

    .photo-wrapper:first-child { margin-top: 0; }

    .photo-wrapper img {
        width: 100%; height: auto; display: block; filter: sepia(10%); 
    }

    .pin {
        position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
        width: 14px; height: 14px; border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #f0f0f0, #bdc3c7, #7f8c8d);
        box-shadow: 2px 3px 5px rgba(0,0,0,0.3), inset 1px 1px 1px rgba(255,255,255,0.8);
        z-index: 10;
    }

    .photo-wrapper:nth-child(even) { transform: translate3d(100px, 100px, 0) rotate(20deg) scale(0.8); }
    .photo-wrapper:nth-child(odd) { transform: translate3d(-100px, 100px, 0) rotate(-20deg) scale(0.8); }

    .photo-wrapper.visible {
        opacity: 1;
        transform: translate3d(var(--x), var(--y), 0) rotate(var(--r)) scale(1) !important;
        animation: floatingPolaroid 5s ease-in-out infinite alternate;
        animation-delay: calc(var(--delay) * 1s);
    }
    
    @keyframes floatingPolaroid {
        0% { transform: translate3d(var(--x), var(--y), 0) rotate(var(--r)); }
        100% { transform: translate3d(var(--x), calc(var(--y) - 10px), 0) rotate(var(--r)); }
    }

    .view-more-btn {
        position: relative; margin-top: 10px; 
        padding: 8px 24px; border: 1px solid #000; background: transparent; color: #000;
        font-size: 11px; letter-spacing: 2px; font-weight: 600; cursor: pointer;
        transition: all 0.3s; opacity: 0; transform: translateY(20px);
    }
    .view-more-btn.visible { opacity: 1; transform: translateY(0); transition-delay: 2.5s; }
    .view-more-btn:active { background: #000; color: #fff; }

    /* =========================================
       [最終鎖定版] 手機版專注閱讀模式 (Reading Mode)
       ========================================= */
    body.reading-mode {
        /* [關鍵] 強制凍結背景 */
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        top: 0 !important;
        left: 0 !important;
        overflow: hidden !important;
        touch-action: none;
    }

    body.reading-mode .text-nav,
    body.reading-mode #mobile-scroll-indicator,
    body.reading-mode .site-intro,
    body.reading-mode #cursor-bubble {
        opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    
    body.reading-mode .scene {
        position: relative;
        z-index: 10000 !important; 
    }

/* 手機版專注閱讀模式 - 修正位置 */
    body.reading-mode .spine-wrapper {
        /* [關鍵修正] translateX(0px)：
           取消偏移，讓書背回到螢幕正中央。
           這樣書本展開時，左右兩邊都會在畫面內，不會被切掉。 */
        transform: rotateX(10deg) translateY(0) scale(0.9) translateX(-50px) !important;
        transition: none !important; 
    }

    body.reading-mode::before {
        content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.6); 
        z-index: 9000; 
        animation: fadeIn 0.5s ease;
        pointer-events: none; 
        backdrop-filter: blur(2px);
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    body.reading-mode .book-page {
         box-shadow: 0 10px 40px rgba(0,0,0,0.5) !important;
    }
}
/* =========================================
   [最終迷你版] 手機版翻頁滑軌 - 精緻圓角方塊
   ========================================= */
#mobile-slider-container {
    position: fixed;
    bottom: 8%;
    left: 50%;
    transform: translateX(-50%);
    
    /* [修改] 尺寸大幅縮小，不佔畫面 */
    width: 55%;  
    height: 36px; 
    
    z-index: 99999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    
    /* 背景：極淡的圓角框 */
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
    border-radius: 12px;
    
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 10px;
}

body.reading-mode #mobile-slider-container {
    opacity: 1;
    pointer-events: auto;
}

/* 軌道 (Track) */
#page-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 4px; /* 細軌道 */
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    outline: none;
    box-shadow: inset 0 0 3px rgba(0,0,0,0.1);
}

/* 滑塊 (Thumb) - 迷你圓角方糖 */
#page-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    
    /* [修改] 滑塊尺寸縮小為 18px */
    width: 18px;
    height: 18px;
    border-radius: 5px; /* 小圓角 */
    
    /* 玻璃質感 */
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(2px);
    box-shadow: 
        inset 0 0 4px rgba(255, 255, 255, 0.9),
        0 2px 5px rgba(0, 0, 0, 0.15);
        
    border: 1px solid rgba(255, 255, 255, 0.8);
    cursor: grab;
    
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.2s;
}

/* 按下狀態 */
#page-slider::-webkit-slider-thumb:active {
    transform: scale(1.3); /* 按下時稍微變大，方便觀察 */
    background: rgba(255, 255, 255, 0.9);
}