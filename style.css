:root {
    --bg-color: #f4f4f4;
    --card-bg: #ffffff;
    --border-color: #111;
}

body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: var(--bg-color);
    overflow: hidden;
    user-select: none;
}

/* =========================================
   1. 3D 場景
   ========================================= */
.scene {
    position: relative;
    width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
    perspective: 2500px;
    overflow: visible; 
    cursor: grab;
}
.scene:active { cursor: grabbing; }

.spine-wrapper {
    position: relative;
    width: 0; height: 0;
    transform-style: preserve-3d;
    /* 俯視角度 */
    transform: rotateX(25deg) translateY(50px);
    transition: transform 0.5s ease;
}

/* 呼吸動畫 */
@keyframes breathing {
    0%, 100% { transform: rotateX(25deg) translateY(50px); }
    50% { transform: rotateX(27deg) translateY(40px); }
}
.scene:hover .spine-wrapper {
    animation: breathing 4s ease-in-out infinite;
}

.book-spine {
    position: absolute; width: 0; height: 0;
    top: 0; left: 0;
    transform-style: preserve-3d;
}

/* =========================================
   2. 卡片容器 (Book Page Container)
   ========================================= */
.book-page {
    position: absolute;
    width: 300px; height: 450px;
    left: 50%; top: 50%;
    margin-left: 0; margin-top: 180px;
    
    transform-origin: left center;
    transform-style: preserve-3d; /* 關鍵：保留子元素 3D 空間 */
    
    cursor: pointer;
    /* 絲滑動畫 */
    transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
}

/* =========================================
   3. 正反面結構 (Front & Back Faces)
   ========================================= */
.page-front, .page-back {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    backface-visibility: hidden; /* 關鍵：隱藏背面 */
    border: 1px solid var(--border-color);
    background-color: #fff;
    display: flex; flex-direction: column;
    
    /* 陰影過渡放在這裡 */
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

/* 正面 */
.page-front {
    z-index: 2;
}

/* 背面 */
.page-back {
    transform: rotateY(180deg); /* 翻轉 180度 */
    background-color: #fff; /* 背面純白 */
    z-index: 1;
}

/* 閉合狀態 */
.book-page.closed {
    transform: rotateY(0deg) translateZ(0) !important;
}
/* 閉合時，正面的陰影 */
.book-page.closed .page-front {
    box-shadow: 1px 0 0 #ccc;
    border-right: 1px solid #ddd;
}

/* Hover 效果 (作用在正面) */
.book-page:hover .page-front {
    box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    border-color: #000;
}
/* 為了讓 hover 時層級最高，加上 z-index 到父層 */
.book-page:hover {
    z-index: 2000 !important;
}

/* 封面樣式 */
.book-page.is-cover .page-front {
    background: #111;
    color: #fff;
    border: 1px solid #000;
}
.book-page.is-cover .page-title { color: #fff; position: absolute; bottom: 20px; left: 20px; font-size: 24px; letter-spacing: 2px; }
.book-page.is-cover .page-index { color: #666; }

/* 頂部線條 */
.page-top {
    position: absolute; top: -1px; left: 0; width: 100%; height: 2px;
    background: #000; display: block;
    backface-visibility: hidden;
}

/* =========================================
   4. 內容排版 (Content inside Front)
   ========================================= */
.page-header {
    height: 30px; border-bottom: 1px solid #111;
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 15px; background: transparent;
    flex-shrink: 0;
}
.page-index { font-size: 12px; font-weight: 900; color: #000; }
.page-year { font-size: 10px; font-family: monospace; color: #666; }

.page-content {
    flex: 1; padding: 15px; 
    display: flex; flex-direction: column; 
    overflow: hidden;
    min-height: 0; 
}

.page-image {
    width: 100%; height: 100%; flex: 1; margin-bottom: 10px;
    background-size: cover; background-position: center; background-repeat: no-repeat;
    border: 1px solid #eee;
    filter: grayscale(100%); transition: filter 0.5s ease;
    display: block; 
}

.book-spine.is-open .book-page:hover .page-image { filter: grayscale(0%); }
.book-page.is-cover .page-image { filter: grayscale(0%); border: none; }

/* --- 修改：卡片底部文字樣式 (靠右、變小、細字) --- */
.page-footer { 
    padding: 15px; 
    border-top: 1px solid #111; 
    flex-shrink: 0; 
    
    /* 新增：靠右對齊 */
    display: flex;
    justify-content: flex-end; 
}

.page-title { 
    /* 修改：字體調整 */
    font-size: 10px; 
    font-weight: 400; 
    text-transform: uppercase; 
    margin: 0; 
    line-height: 1.4; 
    letter-spacing: 1px;
    text-align: right;
    color: #333;
}

/* =========================================
   5. UI 元素
   ========================================= */
.grid-background {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
    background-image: 
        linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-size: 60px 60px; pointer-events: none;
}

.site-intro { position: fixed; top: 40px; left: 40px; z-index: 100; pointer-events: none; }
.site-intro h1 { font-size: 32px; font-weight: 900; margin: 0; line-height: 1; color: #000; }
.site-intro h2 { font-size: 12px; font-weight: 600; margin: 6px 0 0 0; letter-spacing: 2px; color: #666; }

.text-nav {
    position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 50px; z-index: 100;
}
.text-nav span {
    cursor: pointer; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 2px;
    border-bottom: 2px solid transparent; transition: border 0.3s; color: #000;
}
.text-nav span:hover { border-bottom: 2px solid #000; }

/* --- 修改：登入頁面 (粒子隧道背景) --- */
#login-page {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    
    /* 改為純黑背景，移除圖片 */
    background-color: #000; 
    background-image: none; 
    
    z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: white; transition: opacity 0.6s ease;
    overflow: hidden; /* 防止 canvas 溢出 */
}
#login-page.hidden { opacity: 0; display: none !important; pointer-events: none; } 

/* 新增：粒子畫布 */
#particle-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0; /* 在內容後方 */
}

/* 確保登入內容在粒子上方 */
.login-content {
    position: relative;
    z-index: 2;
    text-align: center;
    pointer-events: auto; /* 確保可以點擊 */
}

/* 調整一下日期時間的樣式，配合黑色背景 */
.date-time h1 { font-size: 80px; font-weight: 100; margin: 0; letter-spacing: 5px; }
.date-time p { font-size: 14px; letter-spacing: 3px; color: #aaa; margin-top: 10px; }

/* 調整 Enter 按鈕樣式 (白色框線) */
.password-wrapper {
    margin-top: 40px; cursor: pointer; 
    border: 1px solid rgba(255,255,255,0.3);
    padding: 12px 50px; font-weight: 400; letter-spacing: 4px; font-size: 12px;
    transition: all 0.3s; 
    background: rgba(0,0,0,0.5); 
    color: #fff;
    display: inline-block;
}
.password-wrapper:hover { 
    background: #fff; 
    color: #000; 
    box-shadow: 0 0 20px rgba(255,255,255,0.5);
}

.modal-overlay { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(255,255,255,0.95); z-index: 3000; 
    display: flex; justify-content: center; align-items: center; 
    opacity: 0; transition: opacity 0.3s;
}
.modal-overlay.hidden { display: none !important; pointer-events: none; }
.modal-overlay:not(.hidden) { opacity: 1; display: flex !important; pointer-events: auto; }

.finder-window { width: 80%; max-width: 800px; height: 80vh; background: #fff; border: 2px solid #000; display: flex; flex-direction: column; box-shadow: 20px 20px 0 rgba(0,0,0,0.1); }
.contact-window { max-width: 500px; height: auto; max-height: 80vh; }
.finder-header { height: 60px; border-bottom: 2px solid #000; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; }
.close-icon { font-size: 28px; cursor: pointer; }
.finder-content { padding: 50px; overflow-y: auto; }
.detail-images img { width: 100%; margin-bottom: 20px; border: 1px solid #000; }

.contact-content { display: flex; justify-content: center; padding: 0; }
.contact-card { width: 100%; border: none; }
.contact-row { display: flex; border-bottom: 1px solid #eee; padding: 20px; align-items: baseline; }
.contact-row:last-child { border-bottom: none; }
.label { width: 100px; font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; }
.value { font-size: 16px; font-weight: 500; color: #000; }
.value a { text-decoration: none; color: #000; border-bottom: 1px solid transparent; }
.value a:hover { border-bottom: 1px solid #000; }

.lightbox-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 4000; display: flex; justify-content: center; align-items: center; opacity: 0; }
.lightbox-overlay.hidden { display: none !important; }
.lightbox-overlay:not(.hidden) { opacity: 1; display: flex !important; }
.lightbox-overlay img { max-width: 90%; max-height: 90%; border: 5px solid #fff; box-shadow: 0 0 40px rgba(0,0,0,0.1); }
.close-btn { position: absolute; top: 30px; right: 30px; font-size: 40px; cursor: pointer; }

/* =========================================
   1. 隱藏預設游標
   ========================================= */
@media (min-width: 769px) {
    body, a, div, span {
        cursor: none !important; 
    }
}

/* =========================================
   2. 自定義主游標 (修正：層級提高)
   ========================================= */
#main-cursor {
    position: fixed;
    top: 0; left: 0;
    width: 15px; height: 15px;
    
    background-color: rgba(255, 50, 50, 0.6); /* 紅色半透明 */
    border: none;
    border-radius: 50%;
    
    pointer-events: none; /* 確保點擊能穿透 */
    
    /* 修改：層級設為最高，確保蓋過登入頁 */
    z-index: 9999999 !important; 
    
    will-change: transform;
    display: block; /* 確保顯示 */
}

/* =========================================
   3. OPEN IT 氣泡
   ========================================= */
#cursor-bubble {
    position: fixed;
    top: 0; left: 0; 
    background-color: #000; 
    color: #fff;
    padding: 8px 16px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 900;
    font-style: italic;
    white-space: nowrap;
    pointer-events: none;
    z-index: 10001;
    
    opacity: 0; /* 預設隱藏 */
    transform: scale(0.5);
    transition: opacity 0.2s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#cursor-bubble.active {
    opacity: 1; /* 透過 JS 加上 active 後顯示 */
}

/* 氣泡小箭頭 */
#cursor-bubble::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-width: 6px 6px 0;
    border-style: solid;
    border-color: #000 transparent transparent transparent; 
}

/* =========================================
   4. 漫畫風星星特效 (修改：層級降低)
   ========================================= */
.star-particle {
    position: fixed;
    font-size: 20px;
    color: transparent; 
    -webkit-text-stroke: 1.5px #000; 
    pointer-events: none;
    
    /* 修改這裡：將層級設為 100
       (書本頁面的 z-index 約為 1000，這樣星星就會在書本「下面」或「後面」產生) 
       如果您想要完全不被書本擋住但又不壓在書上，這是不可能的（除非3D空間），
       但設定為 100 可以讓星星感覺像是背景特效，不會遮擋文字。*/
    z-index: 100; 
    
    animation: comic-pop 0.8s ease-out forwards;
}

@keyframes comic-pop {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0) rotate(0deg);
    }
    20% {
        opacity: 1;
    }
    100% {
        opacity: 0;
        transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(var(--scale)) rotate(var(--rot));
    }
}

/* =========================================
   6. 手機版優化 (Mobile Optimization)
   ========================================= */
@media (max-width: 768px) {
    /* --- 1. 書籍可視度調整 --- */
    /* 修改：將 translateY 改為 200px (原本 50px)，讓書籍位置降低 */
    .spine-wrapper {
        transform: rotateX(25deg) translateY(200px) scale(0.6) !important;
    }
    
    /* 更小的螢幕 (如 iPhone SE) */
    @media (max-width: 380px) {
        .spine-wrapper {
            transform: rotateX(25deg) translateY(200px) scale(0.5) !important;
        }
    }

    /* --- 2. 手機版氣泡框 (固定浮動) --- */
    #cursor-bubble {
        transition: opacity 0.3s !important;
    }

    #cursor-bubble.active-mobile {
        opacity: 1 !important;
        transform: translate(-50%, 0) scale(1) !important;
    }

    /* 強制設定位置：螢幕中央水平，垂直位置在書本上方 */
    #cursor-bubble {
        top: 25% !important; 
        left: 50% !important;
        margin: 0 !important;
        animation: float-mobile 2s ease-in-out infinite;
    }

    /* 書籍打開時，手機版氣泡必須隱藏 */
    body.is-book-open #cursor-bubble {
        display: none !important;
        opacity: 0 !important;
        animation: none;
    }
    
    /* 手機版隱藏紅色游標 */
    #main-cursor {
        display: none !important;
    }
}

@keyframes float-mobile {
    0%, 100% { transform: translate(-50%, 0); }
    50% { transform: translate(-50%, -10px); }
}